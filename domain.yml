version: "3.1"

intents:
  - how_to_get_started
  - greet
  - goodbye
  - affirm
  - deny
  - search_agenda
  - search_event
  - contact_info
  - mood_great
  - mood_unhappy
  - bot_challenge
  - fetch_data
  - plot_data
  - explain_data
  - download_data

entities:
  - username
  - event_type
  - venue
  - date
  - search_terms
  - file_format

slots:
  username:
    type: any
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: username
  venue:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: venue
        intent: search_event
  date:
    type: text
    influence_conversation: true
    mappings:
      - type: custom
  data:
    type: any
    influence_conversation: false
    mappings:
      - type: custom
        action: action_fetch_data
  data_meta:
    type: any
    influence_conversation: false
    mappings:
      - type: custom
        action: action_fetch_data
  data_search_terms:
    type: any
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: search_terms
        intent: fetch_data
  data_file_format:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: file_format
        intent: download_data
  # file_url:
  #   type: text
  #   influence_conversation: false
  #   mappings:
  #     - type: custom
  #       action: action_download_data

  # - type: from_entity
  # - type: from_text
  # - type: from_intent
  # - type: from_trigger_intent
  # - type: custom

responses:
  utter_greet:
    - text: "¡Hey {username}! ¿Qué tal estás?"
      buttons:
        - title: "¡Genial!"
          payload: "/mood_great"
        - title: "No muy bien..."
          payload: "/mood_unhappy"
    - text: "¡Hola {name}! ¿Cómo va tu día?"
      channel: "telegram"

  utter_cheer_up:
    - text: "Here is something to cheer you up:"
      image: "https://i.imgur.com/nGF1K8f.jpg"

  utter_did_that_help:
    - text: "Did that help you?"

  utter_happy:
    - text: "Great, carry on!"

  utter_goodbye:
    - text: "Bye"

  utter_iamabot:
    - text: "I am a bot, powered by Rasa."

  utter_anything_else:
    - text: "¿Hay algo más en lo que pueda ayudarte?"

  utter_dataset_menu:
    - text: "¿Quieres saber algo sobre los datos?"
      buttons:
        - title: "Mostar gráfico"
          payload: "/plot_data"
        - title: "Explicar datos"
          payload: "/explain_data"
        - title: "Descargar CSV"
          payload: "/download_data"
        - title: "No"
          payload: "/deny"
      button_type: "inline"

  utter_send_file:
    - custom:
        document: "{file_url}"

actions:
  - action_fetch_data
  - action_plot_data
  - action_explain_data
  - action_download_data

  # utter_event_time:
  #   - custom:
  #     blocks:
  #       - type: section
  #         text:
  #           text: "¿A qué hora?"
  #           type: mrkdwn
  #         accessory:
  #           type: timepicker
  #           placeholder:
  #             type: plain_text
  #             text: Select a time

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
